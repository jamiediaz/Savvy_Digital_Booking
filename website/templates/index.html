<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-1BmE4kWBq78iYhFldvKuhfTAU6auU8tT94WrHftjDbrCEXSU1oBoqyl2QvZ6jIW3" crossorigin="anonymous">
    <!-- <script>
        // Ignore this in your implementation
        window.isMbscDemo = true;
    </script> -->

    <title>Date & time selection</title>

    <!-- Mobiscroll JS and CSS Includes -->
    <link rel="stylesheet" href="../static/css/mobiscroll.javascript.min.css">
    <script src="../static/js/mobiscroll.javascript.min.js"></script>

    <style type="text/css">
        body {
            margin: 0;
            padding: 0;
        }
    
        body,
        html {
            height: 100%;
        }
    
        .md-calendar-booking .mbsc-calendar-text {
            text-align: center;
        }
        
        .md-calendar-booking .booking-datetime .mbsc-datepicker-tab-calendar {
            flex: 1 1 0;
            /* min-width: 100px; */
            max-width: 500px;
        }
        
        .md-calendar-booking .mbsc-timegrid-item {
            margin-top: 1.5em;
            margin-bottom: 1.5em;
        }
        
        .md-calendar-booking .mbsc-timegrid-container {
            top: 30px;
        }
        </style>
    
    </head>
    <body>
    
    <div mbsc-page class="demo-appointment-booking">
      <div style="height:100%">
          <div class="md-calendar-booking"> 
            <!-- <div class="mbsc-form-group">
                <div class="mbsc-form-group-title">Single date & appointment booking</div>
                <div id="demo-booking-single"></div>
            </div> -->
            <div class="mbsc-form-group">
                <div class="mbsc-form-group-title">Select date & time</div>
                <div id="demo-booking-datetime" class="booking-datetime"></div>
            </div>
            <!-- <div class="mbsc-form-group">
                <div class="mbsc-form-group-title">Booking multiple appointments</div>
                <div id="demo-booking-multiple"></div>
            </div> -->
        </div>
      </div>
    </div>
    
    <script>
    
        mobiscroll.setOptions({
            locale: mobiscroll.localeEn,             // Specify language like: locale: mobiscroll.localePl or omit setting to use default
             theme: 'ios',                            // Specify theme like: theme: 'ios' or omit setting to use default
            themeVariant: 'light'                    // More info about themeVariant: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-themeVariant
        });
        
        var min = '2021-11-25T00:00';
        var max = '2022-05-25T00:00';
        
        // mobiscroll.datepicker('#demo-booking-single', {
        //     display: 'inline',                       // Specify display mode like: display: 'bottom' or omit setting to use default
        //     controls: ['calendar'],                  // More info about controls: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-controls
        //     min: min,                                // More info about min: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-min
        //     max: max,                                // More info about max: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-max
        //     pages: 'auto',
        //     onPageLoading: function (event, inst) {  // More info about onPageLoading: https://docs.mobiscroll.com/5-12-1/javascript/calendar#event-onPageLoading
        //         getPrices(event.firstDay, function callback(bookings) {
        //             inst.setOptions({
        //                 labels: bookings.labels,     // More info about labels: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-labels
        //                 invalid: bookings.invalid    // More info about invalid: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-invalid
        //             });
        //         });
        //     }
        // });
        
        mobiscroll.datepicker('#demo-booking-datetime', {
            display: 'inline',                       // Specify display mode like: display: 'bottom' or omit setting to use default
            controls: ['calendar', 'timegrid'],  
            invalid: [
		                {
			recurring: {
				repeat: 'weekly',
				weekDays: 'SA,SU'
			            }
		                }
	                ],                               // More info about controls: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-controls
            min: min,                                // More info about min: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-min
            max: max,                                // More info about max: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-max
            minTime: '09:00',
            maxTime: '16:29',
            stepMinute: 30,
            width: null,                             // More info about width: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-width
            onPageLoading: function (event, inst) {  // More info about onPageLoading: https://docs.mobiscroll.com/5-12-1/javascript/calendar#event-onPageLoading
                getDatetimes(event.firstDay, function callback(bookings) {
                    inst.setOptions({
                        labels: bookings.labels,     // More info about labels: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-labels
                        invalid: bookings.invalid    // More info about invalid: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-invalid
                    });
                });
            }
        });
        
        mobiscroll.datepicker('#demo-booking-multiple', {
            display: 'inline',                       // Specify display mode like: display: 'bottom' or omit setting to use default
            controls: ['calendar'],                  // More info about controls: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-controls
            min: min,                                // More info about min: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-min
            max: max,                                // More info about max: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-max
            pages: 'auto',
            selectMultiple: true,
            onInit: function (event, inst) {         // More info about onInit: https://docs.mobiscroll.com/5-12-1/javascript/calendar#event-onInit
                inst.setVal([
                    '2021-11-11T00:00',
                    '2021-11-16T00:00',
                    '2021-11-17T00:00'
                ], true);
            },
            onPageLoading: function (event, inst) {  // More info about onPageLoading: https://docs.mobiscroll.com/5-12-1/javascript/calendar#event-onPageLoading
                getBookings(event.firstDay, function callback(bookings) {
                    inst.setOptions({
                        labels: bookings.labels,     // More info about labels: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-labels
                        invalid: bookings.invalid    // More info about invalid: https://docs.mobiscroll.com/5-12-1/javascript/calendar#opt-invalid
                    });
                });
            }
        });
        
        function getPrices(d, callback) {
            var invalid = [],
                labels = [];
        
            mobiscroll.util.http.getJson('https://trial.mobiscroll.com/getprices/?year=' + d.getFullYear() + '&month=' + d.getMonth(), function (bookings) {
                for (var i = 0; i < bookings.length; ++i) {
                    var booking = bookings[i],
                        d = new Date(booking.d);
        
                    if (booking.price > 0) {
                        labels.push({
                            start: d,
                            title: '$' + booking.price,
                            textColor: '#e1528f'
                        });
                    } else {
                        invalid.push(d);
                    }
                }
                callback({ labels: labels, invalid: invalid });
            }, 'jsonp');
        }
    
        function getDatetimes(day, callback) {
            var invalid = [];
            var labels = [];
        
            mobiscroll.util.http.getJson('https://trial.mobiscroll.com/getbookingtime/?year=' + day.getFullYear() + '&month=' + day.getMonth(), function (bookings) {
                for (var i = 0; i < bookings.length; ++i) {
                    var booking = bookings[i];
                    var bDate = new Date(booking.d);
        
                    if (booking.nr > 0) {
                        labels.push({
                            start: bDate,
                            title: booking.nr + ' SPOTS',
                            textColor: '#e1528f'
                        });
                        $.merge(invalid, booking.invalid);
                    } else {
                        invalid.push(bDate);
                    }
                }
                callback({ labels: labels, invalid: invalid });
            }, 'jsonp');
        }
        
        function getBookings(d, callback) {
            var invalid = [],
                labels = [];
        
            mobiscroll.util.http.getJson('https://trial.mobiscroll.com/getbookings/?year=' + d.getFullYear() + '&month=' + d.getMonth(), function (bookings) {
                for (var i = 0; i < bookings.length; ++i) {
                    var booking = bookings[i],
                        d = new Date(booking.d);
        
                    if (booking.nr > 0) {
                        labels.push({
                            start: d,
                            title: booking.nr + ' SPOTS',
                            textColor: '#e1528f'
                        });
                    } else {
                        invalid.push(d);
                    }
                }
                callback({ labels: labels, invalid: invalid });
            }, 'jsonp');
        }
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
</body>
</html>
